import fs from 'fs';

const NEW_MONSTER_DATA = {
    'lv5_paladin': {
        palette: "[null, '#cbd5e1', '#94a3b8', '#1e293b', '#fff', '#3b82f6', '#1e40af', '#facc15', '#000']",
        data: `[
            [0, 0, 0, 0, 0, 0, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0], // 8=兜の先(金)
            [0, 0, 0, 0, 0, 8, 7, 7, 7, 8, 0, 0, 0, 0, 0, 0], // 7=明金
            [0, 0, 0, 0, 8, 1, 1, 1, 1, 1, 8, 0, 0, 0, 0, 0], // 1=メイン白銀
            [0, 0, 0, 8, 1, 1, 1, 1, 1, 1, 1, 8, 0, 0, 0, 0],
            [0, 0, 0, 8, 1, 6, 6, 6, 6, 6, 1, 8, 0, 0, 0, 0], // 6=青い神聖な光
            [0, 0, 8, 1, 1, 6, 4, 6, 6, 4, 1, 1, 8, 0, 0, 0], // 4=バイザーハイライト
            [0, 0, 8, 1, 1, 6, 6, 6, 6, 6, 1, 1, 8, 0, 0, 0],
            [0, 0, 0, 8, 1, 1, 1, 1, 1, 1, 1, 8, 0, 0, 0, 0],
            [0, 8, 8, 8, 8, 2, 2, 2, 2, 2, 8, 1, 1, 8, 0, 0], // 2=濃い銀, 左手に大盾
            [8, 7, 7, 7, 7, 8, 2, 2, 2, 2, 8, 1, 1, 8, 0, 0], // 7=盾の黄色いフチ
            [8, 7, 1, 1, 7, 8, 2, 2, 2, 2, 8, 5, 5, 8, 0, 0], // 5=青いマント
            [8, 7, 1, 5, 7, 8, 2, 2, 2, 2, 8, 5, 5, 8, 0, 0], // 盾の紋章(5)
            [8, 7, 1, 1, 7, 8, 8, 8, 8, 8, 8, 5, 5, 8, 0, 0], 
            [0, 8, 7, 7, 8, 0, 8, 2, 8, 2, 8, 8, 8, 8, 0, 0],
            [0, 0, 8, 8, 0, 0, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        ]`
    },
    'lv5_sage': {
        palette: "[null, '#60a5fa', '#2563eb', '#000', '#fff', '#fef08a', '#eab308', '#d1d5db', '#1e3a8a']",
        data: `[
            [0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0], // 4=金オーラ・光
            [0, 0, 4, 8, 8, 8, 8, 8, 8, 8, 8, 4, 0, 0, 0, 0], // 8=帽子
            [0, 4, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 4, 0, 0, 0],
            [0, 4, 0, 0, 8, 1, 1, 1, 1, 8, 0, 0, 4, 0, 0, 0], // 顔(1=青)
            [0, 4, 0, 8, 1, 1, 1, 1, 1, 1, 8, 0, 4, 6, 6, 0], // 6=魔法のエフェクト玉
            [0, 4, 0, 8, 1, 7, 7, 1, 7, 7, 1, 8, 4, 6, 4, 6], // メガネ(7)
            [0, 4, 0, 8, 7, 4, 3, 7, 4, 3, 7, 8, 4, 6, 6, 0], // 目
            [0, 4, 0, 8, 7, 7, 7, 1, 7, 7, 7, 8, 4, 0, 0, 0],
            [0, 4, 0, 8, 1, 4, 4, 4, 4, 4, 1, 8, 4, 0, 0, 0], // ヒゲがさらに伸びる
            [0, 0, 4, 8, 2, 4, 4, 4, 4, 2, 8, 4, 0, 0, 0, 0], // 2=濃い青ローブ
            [0, 0, 4, 8, 5, 2, 2, 2, 2, 5, 8, 4, 0, 0, 0, 0], // 5=金装飾
            [0, 0, 0, 8, 5, 2, 2, 2, 2, 5, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 8, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 8, 2, 8, 0, 0, 8, 2, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 8, 8, 8, 0, 0, 8, 8, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        ]`
    },
    'lv5_angel': {
        palette: "[null, '#f472b6', '#db2777', '#000', '#fff', '#fef08a', '#eab308', '#ec4899', '#fdf2f8']",
        data: `[
            [0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0], // 5=金(天使の輪)
            [0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0],
            [0, 0, 4, 4, 8, 1, 1, 1, 1, 1, 8, 4, 4, 0, 0, 0], // 4=純白の大きな翼, 1=ピンク
            [0, 4, 4, 4, 8, 3, 3, 1, 3, 3, 8, 4, 4, 4, 0, 0], // 3=目(黒)
            [0, 4, 4, 4, 8, 4, 1, 1, 1, 4, 8, 4, 4, 4, 0, 0], // にっこり
            [4, 4, 4, 4, 8, 1, 5, 5, 5, 1, 8, 4, 4, 4, 4, 0],
            [4, 4, 4, 4, 4, 8, 2, 2, 2, 8, 4, 4, 4, 4, 4, 0], // 2=濃ピンクドレス
            [4, 4, 4, 4, 4, 8, 2, 2, 2, 8, 4, 4, 4, 4, 4, 0],
            [0, 4, 4, 4, 8, 2, 2, 4, 2, 2, 8, 4, 4, 4, 0, 0], // 4=白装飾
            [0, 4, 4, 8, 2, 2, 4, 4, 4, 2, 2, 8, 4, 4, 0, 0],
            [0, 0, 4, 8, 2, 4, 4, 4, 4, 4, 2, 8, 4, 0, 0, 0],
            [0, 0, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0],
            [0, 0, 0, 0, 8, 1, 8, 0, 8, 1, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        ]`
    },
    'lv5_beast': {
        palette: "[null, '#6b7280', '#374151', '#000', '#fff', '#fef08a', '#eab308', '#dc2626', '#1f2937']",
        data: `[
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 8, 8, 0, 0, 0, 0, 0, 0, 8, 8, 0, 0, 0, 0], // 獣の耳(大きい)
            [0, 8, 1, 1, 8, 0, 0, 0, 0, 8, 1, 1, 8, 0, 0, 0], // 1=グレー
            [0, 8, 1, 1, 1, 8, 8, 8, 8, 1, 1, 1, 8, 0, 0, 0],
            [0, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 0, 0, 0],
            [0, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 0, 0, 0],
            [0, 8, 1, 3, 3, 1, 1, 1, 1, 3, 3, 1, 8, 0, 0, 0], // 3=真っ黒の目
            [0, 8, 1, 3, 5, 5, 3, 1, 3, 5, 5, 3, 8, 0, 0, 0], // 5=鋭い黄色の瞳
            [0, 8, 1, 1, 1, 1, 8, 8, 1, 1, 1, 1, 8, 0, 0, 0], // 鼻
            [0, 0, 8, 1, 1, 8, 7, 7, 8, 1, 1, 8, 0, 0, 0, 0], // 7=血のように赤い口
            [0, 0, 8, 1, 8, 4, 8, 8, 4, 8, 1, 8, 0, 0, 0, 0], // 4=牙
            [0, 8, 2, 2, 1, 1, 1, 1, 1, 1, 2, 2, 8, 0, 0, 0], // 2=首・背中の濃い体毛
            [0, 8, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 8, 0, 0, 0],
            [8, 2, 2, 2, 8, 2, 2, 2, 2, 8, 2, 2, 2, 8, 0, 0], // 爪と四つ足感
            [8, 4, 4, 8, 0, 8, 8, 8, 8, 0, 8, 4, 4, 8, 0, 0],
            [0, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0, 8, 8, 0, 0, 0]
        ]`
    },
    'lv5_dragon': {
        palette: "[null, '#ef4444', '#b91c1c', '#000', '#fff', '#facc15', '#f59e0b', '#fbbf24', '#7f1d1d']",
        data: `[
            [0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0], // 8=黒のツノ
            [0, 0, 8, 5, 8, 0, 0, 0, 0, 8, 5, 8, 0, 0, 0, 0], // 5=立派な金の角
            [0, 0, 8, 5, 5, 8, 0, 0, 8, 5, 5, 8, 0, 0, 0, 0],
            [0, 8, 2, 2, 2, 2, 8, 8, 2, 2, 2, 2, 8, 0, 0, 0], // 2=濃赤の翼
            [0, 8, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 8, 0, 0, 0], // 1=メインの赤
            [0, 8, 2, 1, 1, 3, 1, 1, 1, 3, 1, 2, 8, 0, 0, 0], // 3=目
            [8, 2, 2, 1, 3, 5, 5, 1, 3, 5, 5, 1, 2, 2, 8, 0], // 5=黄金の瞳で睨む
            [8, 2, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 2, 8, 0], // 翼の骨
            [8, 8, 0, 8, 1, 1, 8, 8, 1, 1, 1, 8, 0, 8, 8, 0], // 鼻
            [0, 0, 0, 8, 1, 8, 1, 1, 8, 1, 1, 8, 0, 0, 0, 0],
            [0, 0, 0, 0, 8, 1, 1, 1, 1, 1, 8, 0, 0, 0, 0, 0], // 腹
            [0, 0, 0, 0, 8, 6, 6, 6, 6, 6, 8, 0, 0, 0, 0, 0], // 6=オレンジの竜の腹
            [0, 0, 0, 0, 8, 6, 6, 6, 6, 6, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 8, 6, 6, 6, 6, 6, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        ]`
    }
};

const FILES = ['./src/pixel-engine.js', './src/pixel-engine-static.js'];

function replaceMonsterData(source) {
    let result = source;
    for (const [id, newData] of Object.entries(NEW_MONSTER_DATA)) {
        const blockRegex = new RegExp(`(id:\\s*'${id}'.*?palette:\\s*\\[)(.*?)(\\],.*?data:\\s*\\[)(.*?)(\\]\\s*\\n*\\s*\\})`, 's');

        result = result.replace(blockRegex, (match, p1, p2, p3, p4, p5) => {
            let replacementPalette = newData.palette.trim();
            if (replacementPalette.startsWith('[')) replacementPalette = replacementPalette.substring(1);
            if (replacementPalette.endsWith(']')) replacementPalette = replacementPalette.substring(0, replacementPalette.length - 1);

            let replacementData = newData.data.trim();
            if (replacementData.startsWith('[')) replacementData = replacementData.substring(1);
            if (replacementData.endsWith(']')) replacementData = replacementData.substring(0, replacementData.length - 1);

            return p1 + replacementPalette + p3 + replacementData + p5;
        });
    }
    return result;
}

FILES.forEach(file => {
    if (fs.existsSync(file)) {
        let src = fs.readFileSync(file, 'utf8');
        let updated = replaceMonsterData(src);
        fs.writeFileSync(file, updated, 'utf8');
        console.log(`Updated ${file}`);
    }
});
